{% extends "layout.html" %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/compare_bikes.css') }}">
<script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.js"></script>


<div class="main-header" style="background: #fff; border-radius: 0 0 12px 12px; border-bottom: 4px solid #d32f2f; padding: 24px 16px 12px 16px; margin-bottom: 24px;">
    <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-3">
        <div class="flex-grow-1 text-center">
            <h1 class="mb-2" style="color: #111; font-weight: 800; letter-spacing: 0.5px; font-size: 2.1rem;">
                השוואת אופניים
            </h1>
        </div>
        <div class="w-100 w-md-auto d-flex justify-content-center justify-content-md-end">
            <a href="{{ url_for('bikes.bikes') }}" class="btn btn-outline-danger" style="font-weight: 500; min-width: 140px;">
                <i class="fas fa-arrow-right"></i> חזור לדף הראשי
            </a>
        </div>
    </div>
</div>

<div class="comparison-header" style="background: #f8f9fa; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); padding: 32px 16px 24px 16px; margin-bottom: 32px; border: 1px solid #eee;">
    <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-3">
        <div class="flex-grow-1 text-center">
            <h2 class="mb-2" style="color: #111; font-weight: 700; letter-spacing: 0.5px; font-size: 1.5rem;">
                השוואת מומחה
                <span style="color: #d32f2f; font-size: 1.2em; vertical-align: middle;">🤖</span>
            </h2>
            <div style="width: 60px; height: 4px; background: #d32f2f; margin: 0 auto 12px auto; border-radius: 2px;"></div>
        </div>
        <div class="w-100 w-md-auto" style="max-width: 350px;">
            <div id="ai-loading" style="display:none; text-align:center; margin:0 0 12px 0;">
                <span id="ai-spinner" class="spinner-border text-danger" role="status" style="width: 2.5rem; height: 2.5rem; vertical-align: middle;">
                    <span class="visually-hidden">Loading...</span>
                </span>
                <span id="ai-thinking-text" style="font-size: 1.1em; margin-right: 12px; vertical-align: middle; color: #111;">המומחה שלנו חושב עבורך<span id="ai-dots"></span></span>
            </div>
            <div dir="rtl" id="ai-intro" class="fs-6 text-center" style="color: #333; min-height: 24px;"></div>
        </div>
    </div>
</div>

<div dir="rtl" class="container mt-4" id="ai-comparison-container" style="display: none;">
    <div class="bg-light rounded p-3 mb-4">
        <h4>🏆 ההמלצה שלנו</h4>
        <p id="ai-recommendation" class="fw-bold"></p>
    </div>
    <div class="mb-4" id="ai-bike-analysis"></div>

    <div class="alert alert-info text-center" id="ai-expert-tip" role="alert"></div>
</div>

{% if bikes and bikes|length > 0 %}
<div class="compare-container overflow-auto">
         <table class="table table-bordered compare-table text-center align-middle">
         <thead>
             <tr>
                 {% for bike in bikes %}
                 <th class="specs-th align-middle" style="min-width: 160px; max-width: 180px;">
     <button class="btn-close position-absolute top-0 end-0 m-2 remove-bike-btn"
             data-bike-id="{{ bike['id'] }}" aria-label="Remove"></button>
     <div style="display: flex; flex-direction: column; align-items: center; justify-content: flex-start;">
         <div style="height: 100px; display: flex; align-items: center;">
             <img src="{{ bike['image_url'] }}" alt="{{ bike['model'] }}" class="img-fluid mb-2"
                  style="max-height: 100px; max-width: 100%; object-fit: contain; border-radius: 6px; background: #f8f9fa; padding: 4px;" referrerpolicy="no-referrer">
         </div>
         <h5 class="mb-1" style="font-size: 1.05em; color: #000000; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 140px;" title="{{ bike['firm'] }}">{{ bike['firm'] }}</h5>
     </div>
 </th>
                 {% endfor %}
                 <th class="model-th" style="position:relative;"></th>
             </tr>
         </thead>
         <tbody>
            <!-- רכישה -->
            <tr>
                {% for bike in bikes %}
                <td>
                    {% if bike['product_url'] %}
                        <a href="{{ bike['product_url'] }}" target="_blank" rel="noopener" class="btn btn-outline-primary">
                            <i class="fas fa-shopping-cart me-1"></i>
                            רכישה
                        </a>
                    {% else %}
                        <span class="text-muted">לא זמין</span>
                    {% endif %}
                </td>
                {% endfor %}
                <th style="min-width: 150px; background: #fff; text-align: right;"></th>
            </tr>
             <!-- דגם -->
             <tr>
                 {% for bike in bikes %}
                 <td>{{ bike['model'] }}</td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">דגם</th>
             </tr>

             <!-- שנה -->
             <tr>
                 {% for bike in bikes %}
                 <td>{{ bike['year'] }}</td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">שנה</th>
             </tr>

             <!-- מחיר -->
             <tr>
                 {% for bike in bikes %}
                 <td>
                     {% if bike['disc_price'] and bike['disc_price'] != '#N/A' %}
                         {% if bike['price'] | format_number == 'צור קשר' %}
                             <span style="text-decoration: line-through; color: #888;">{{ bike['price'] | format_number }}</span><br>
                         {% else %}
                             <span style="text-decoration: line-through; color: #888;">₪{{ bike['price'] | format_number }}</span><br>
                         {% endif %}
                         {% if bike['disc_price'] | format_number == 'צור קשר' %}
                             <span class="text-danger fw-bold">{{ bike['disc_price'] | format_number }}</span>
                         {% else %}
                             <span class="text-danger fw-bold">₪{{ bike['disc_price'] | format_number }}</span>
                         {% endif %}
                     {% else %}
                         {% if bike['price'] | format_number == 'צור קשר' %}
                             {{ bike['price'] | format_number }}
                         {% else %}
                             ₪{{ bike['price'] | format_number }}
                         {% endif %}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">מחיר</th>
             </tr>

             <!-- סוג אופניים -->
             {% if 'sub_category' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('sub_category', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:20] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">סוג אופניים</th>
             </tr>
             {% endif %}

             <!-- קיבולת סוללה -->
             {% if 'wh' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('wh', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:20] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">קיבולת סוללה</th>
             </tr>
             {% endif %}

             <!-- מנוע -->
             {% if 'motor' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('motor', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">מנוע</th>
             </tr>
             {% endif %}

             <!-- סוללה -->
             {% if 'battery' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('battery', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">סוללה</th>
             </tr>
             {% endif %}

             <!-- שלדה -->
             {% if 'frame' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('frame', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">שלדה</th>
             </tr>
             {% endif %}

             <!-- בולם קדמי -->
             {% if 'fork' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('fork', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">בולם קדמי</th>
             </tr>
             {% endif %}

             <!-- בולם אחורי -->
             {% if 'rear_shock' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('rear_shock', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">בולם אחורי</th>
             </tr>
             {% endif %}

             <!-- בלמים -->
             {% if 'brakes' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('brakes', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">בלמים</th>
             </tr>
             {% endif %}

             <!-- צמיגים -->
             {% if 'tires' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('tires', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">צמיגים</th>
             </tr>
             {% endif %}

             <!-- משקל -->
             {% if 'weight' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('weight', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">משקל</th>
             </tr>
             {% endif %}

             <!-- גודל גלגלים -->
             {% if 'wheel_size' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('wheel_size', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">גודל גלגלים</th>
             </tr>
             {% endif %}

             <!-- מידה -->
             {% if 'size' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('size', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">מידה</th>
             </tr>
             {% endif %}

             <!-- מספר הילוכים -->
             {% if 'gear_count' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('gear_count', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">מספר הילוכים</th>
             </tr>
             {% endif %}

             <!-- ברקס קידמי -->
             {% if 'front_brake' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('front_brake', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:40] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">ברקס קידמי</th>
             </tr>
             {% endif %}

             <!-- ברקס אחורי -->
             {% if 'rear_brake' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('rear_brake', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">ברקס אחורי</th>
             </tr>
             {% endif %}

             <!-- צמיג קדמי -->
             {% if 'front_tire' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('front_tire', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">צמיג קדמי</th>
             </tr>
             {% endif %}

             <!-- צמיג אחורי -->
             {% if 'rear_tire' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('rear_tire', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">צמיג אחורי</th>
             </tr>
             {% endif %}

             <!-- אוכף -->
             {% if 'saddle' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('saddle', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">אוכף</th>
             </tr>
             {% endif %}

             <!-- דוושות -->
             {% if 'pedals' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('pedals', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">דוושות</th>
             </tr>
             {% endif %}

             <!-- מטען -->
             {% if 'charger' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('charger', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">מטען</th>
             </tr>
             {% endif %}

             <!-- מסך -->
             {% if 'screen' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('screen', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">מסך</th>
             </tr>
             {% endif %}

             <!-- תוספות -->
             {% if 'extras' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('extras', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">תוספות</th>
             </tr>
             {% endif %}

             <!-- מעביר אחורי -->
             {% if 'rear_der' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('rear_der', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">מעביר אחורי</th>
             </tr>
             {% endif %}

             <!-- שיפטר -->
             {% if 'shifter' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('shifter', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">שיפטר</th>
             </tr>
             {% endif %}

             <!-- קראנק -->
             {% if 'crank_set' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('crank_set', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">קראנק</th>
             </tr>
             {% endif %}

             <!-- מדריך שרשרת -->
             {% if 'chain_guide' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('chain_guide', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">מדריך שרשרת</th>
             </tr>
             {% endif %}

             <!-- שרשרת -->
             {% if 'chain' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('chain', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:60] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">שרשרת</th>
             </tr>
             {% endif %}

             <!-- קסטה -->
             {% if 'cassette' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('cassette', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">קסטה</th>
             </tr>
             {% endif %}

             <!-- רוטורים -->
             {% if 'rotors' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('rotors', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">רוטורים</th>
             </tr>
             {% endif %}

             <!-- כידון -->
             {% if 'handlebar' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('handlebar', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">כידון</th>
             </tr>
             {% endif %}

             <!-- מוט אוכף -->
             {% if 'seat_post' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('seat_post', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:40] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">מוט אוכף</th>
             </tr>
             {% endif %}

             <!-- סטם -->
             {% if 'stem' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('stem', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:40] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">סטם</th>
             </tr>
             {% endif %}

             <!-- תאורה -->
             {% if 'lights' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('lights', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">תאורה</th>
             </tr>
             {% endif %}

             <!-- גלגלים -->
             {% if 'wheels' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('wheels', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:40] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">גלגלים</th>
             </tr>
             {% endif %}

             <!-- חישוקים -->
             {% if 'rims' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('rims', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:40] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">חישוקים</th>
             </tr>
             {% endif %}

             <!-- חישורים -->
             {% if 'spokes' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('spokes', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:60] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">חישורים</th>
             </tr>
             {% endif %}

             <!-- ציר קדמי -->
             {% if 'front_hub' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('front_hub', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">ציר קדמי</th>
             </tr>
             {% endif %}

             <!-- ציר אחורי -->
             {% if 'rear_hub' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('rear_hub', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">ציר אחורי</th>
             </tr>
             {% endif %}

             <!-- הד סט -->
             {% if 'headset' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('headset', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">הד סט</th>
             </tr>
             {% endif %}

             <!-- שלט -->
             {% if 'remote' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('remote', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:40] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">שלט</th>
             </tr>
             {% endif %}

             <!-- אורך בולמים -->
             {% if 'fork_length' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('fork_length', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">אורך בולמים</th>
             </tr>
             {% endif %}

             <!-- פנימיות -->
             {% if 'tubes' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('tubes', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">פנימיות</th>
             </tr>
             {% endif %}

             <!-- גלגל קדמי -->
             {% if 'front_wheel' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('front_wheel', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">גלגל קדמי</th>
             </tr>
             {% endif %}

             <!-- גלגל אחורי -->
             {% if 'rear_wheel' in fields_to_show %}
             <tr>
                 {% for bike in bikes %}
                 <td class="collapsible-cell">
                     {% set value = bike.get('rear_wheel', '') %}
                     {% set value_str = value|string %}
                     {% if value_str|length > 40 %}
                         <span class="cell-short">{{ value_str[:25] }}...</span>
                         <span class="cell-full" style="display:none;">{{ value_str }}</span>
                         <button class="btn btn-link btn-sm show-more-btn" style="padding:0; font-size:0.85em;">הצג עוד</button>
                     {% else %}
                         {{ value_str }}
                     {% endif %}
                 </td>
                 {% endfor %}
                 <th style="min-width: 150px; background: #fff; text-align: right;">גלגל אחורי</th>
             </tr>
             {% endif %}
         </tbody>

     </table>
</div>


{% else %}
<div class="alert alert-info text-center">
    לא נבחרו אופניים להשוואה.
</div>
{% endif %}


<!-- WhatsApp Floating Share Button -->
<div id="whatsapp-share-float" style="display: none; position: fixed; bottom: 24px; right: 24px; z-index: 9999; align-items: center; cursor: pointer;">
    <span style="background: #25D366; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#fff" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.198.297-.767.966-.94 1.164-.173.198-.347.223-.644.075-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.372-.025-.521-.075-.149-.669-1.611-.916-2.206-.242-.579-.487-.5-.669-.51-.173-.008-.372-.01-.571-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.363.709.306 1.262.489 1.694.626.712.227 1.36.195 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.617h-.001a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.455 4.436-9.89 9.893-9.89 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.896 6.991c-.003 5.455-4.438 9.89-9.893 9.89m8.413-18.304A11.815 11.815 0 0 0 12.05.001C5.495 0 .001 5.493 0 12.247c0 2.159.566 4.268 1.641 6.115L.057 23.925a1.001 1.001 0 0 0 1.225 1.225l5.605-1.584a11.88 11.88 0 0 0 5.162 1.211h.005c6.554 0 11.947-5.492 11.95-12.247a11.82 11.82 0 0 0-3.486-8.651"/>
        </svg>
    </span>
    <span style="margin-right: 10px; font-weight: bold; color: #25D366; background: #fff; padding: 6px 14px; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.10); font-size: 1.1em;">!שתף</span>
</div>

<script src="{{ url_for('static', filename='js/compare_bikes.js') }}"></script>

{% endblock %}

