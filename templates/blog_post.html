{% extends "layout.html" %}

{% block title %}
<title>{% if post.seo_title %}{{ post.seo_title }}{% else %}{{ post.title }}{% endif %} | בלוג Rideal</title>
{% endblock %}

{% block meta %}
{% set post_url = url_for('blog.blog_post', slug=post.slug, _external=True) %}
{% set meta_title = post.seo_title if post.seo_title else post.title %}
{% set meta_description = post.seo_description if post.seo_description else (post.content[:150] | striptags | replace('\n', ' ') | trim if post.content else 'מאמר מעניין על אופניים') %}
{% if meta_description | length > 160 %}
{% set meta_description = meta_description[:157] ~ '...' %}
{% endif %}
{% set og_image = post.hero_image if post.hero_image else url_for('static', filename='images/rideal_logo_bg.png', _external=True) %}

<meta name="description" content="{{ meta_description }}">
<link rel="canonical" href="{{ post_url }}">

<!-- Open Graph / Facebook / WhatsApp / Telegram -->
<meta property="og:type" content="article">
<meta property="og:url" content="{{ post_url }}">
<meta property="og:title" content="{{ meta_title }}">
<meta property="og:description" content="{{ meta_description }}">
<meta property="og:image" content="{{ og_image }}">
{% if post.date %}
<meta property="article:published_time" content="{{ post.date.strftime('%Y-%m-%dT%H:%M:%S') }}">
{% endif %}
{% if post.author %}
<meta property="article:author" content="{{ post.author }}">
{% endif %}
<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ post_url }}">
<meta name="twitter:title" content="{{ meta_title }}">
<meta name="twitter:description" content="{{ meta_description }}">
<meta name="twitter:image" content="{{ og_image }}">

<!-- BlogPosting Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ meta_title | replace('"', '\\"') }}",
  "description": "{{ meta_description | replace('"', '\\"') }}",
  "url": "{{ post_url }}",
  {% if post.date %}
  "datePublished": "{{ post.date.strftime('%Y-%m-%dT%H:%M:%S') }}",
  "dateModified": "{{ post.date.strftime('%Y-%m-%dT%H:%M:%S') }}",
  {% endif %}
  "author": {
    "@type": "Person",
    "name": "{{ post.author | replace('"', '\\"') if post.author else 'Rideal' }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Rideal",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ url_for('static', filename='images/rideal_logo_bg.png', _external=True) }}"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ post_url }}"
  }
}
</script>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/blog_posts.css') }}">


<div class="container my-5" dir="rtl">
    <article class="p-4 shadow-lg rounded bg-white border-end border-4" style="border-color: red; max-width: 900px; margin: auto;">

        <!-- Title -->
        <header class="mb-4">
            <h1 class="fw-bold text-black display-5">{{ post.title }}</h1>
            <div class="d-flex justify-content-between text-muted small">
                <div><i class="bi bi-person-circle"></i> {{ post.author }}</div>
                <div><i class="bi bi-calendar-event"></i> {{ post.date.strftime('%d/%m/%Y') if post.date else '' }}</div>
            </div>
        </header>

        <!-- Hero Image -->
        {% if post.hero_image %}
        <div class="mb-4">
            <img src="{{ post.hero_image }}" alt="{{ post.title }}" class="img-fluid rounded">
        </div>
        {% endif %}

        <!-- Divider -->
        <hr class="border-danger opacity-100">

        <!-- Tags -->
        {% if post.tags %}
        <div class="mb-4">
            {% for tag in post.tags.split(',') %}
            <span class="badge bg-secondary me-1">{{ tag.strip() }}</span>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Blog Content -->
        <section class="post-content lh-lg text-black" style="font-size: 1.15rem;">
            {{ post.content | safe }}
        </section>

        <!-- Back to Blog List / Admin Panel -->
        <div class="mt-5 text-start">
            {% if is_preview %}
            <a href="{{ url_for('admin.blog_list') }}" class="btn btn-outline-primary rounded-pill px-4 me-2">
                ← חזרה לפאנל הניהול
            </a>
            {% endif %}
            <a href="{{ url_for('blog.blog_list') }}" class="btn btn-outline-danger rounded-pill px-4">
                ← חזרה לרשימת הפוסטים
            </a>
        </div>
    </article>
</div>
{% endblock %}
